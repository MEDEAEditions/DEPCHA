<?xml version="1.0" encoding="UTF-8"?>
<!-- 
    Project: GAMS Projekttemplate
    Company: ZIM-ACDH (Zentrum fÃ¼r Informationsmodellierung - Austrian Centre for Digital Humanities)
 -->

<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="2.0"
    xmlns:i18n="http://apache.org/cocoon/i18n/2.1"
    xmlns:s="http://www.w3.org/2001/sw/DataAccess/rf1/result" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:t="http://www.tei-c.org/ns/1.0" xmlns:oai_dc="http://www.openarchives.org/OAI/2.0/oai_dc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/" exclude-result-prefixes="#all">

    <xsl:output method="xml" doctype-system="about:legacy-compat" encoding="UTF-8" indent="no"/>


    <xsl:include href="depcha-static.xsl"/>

    <xsl:template name="content">
        <xsl:choose>
            <!-- ///////////////////////// -->
            <!-- IMPRINT -->
            <xsl:when test="$mode = 'imprint'">
                <section class="col-md-12">
                    <article  class="card">
                        <div class="card-body">
                            <xsl:apply-templates select="document(concat('/context:depcha/', 'IMPRINT'))/t:TEI/t:text/t:body/t:div"/>
                        </div>
                    </article>
                </section>
            </xsl:when>
            
            <!-- ///////////////////////// -->
            <!-- DATABASKET -->
            <xsl:when test="$mode = 'databasket'">
                <section class="col-md-12">
                    <article  class="card">
                        <div class="card-header"> 
                            <h1 class="card-title">
                                <xsl:text>DATA BASKET</xsl:text>
                            </h1>
                            <div>
                                <p>
                                    <xsl:text>Data entries can be added to the data basket.</xsl:text><br/>
                                </p>
                                <div class="btn-group" role="group" aria-label="Sortieren">
                                    <button type="button" class="btn hidden-print" style="font-size:18px; background: none"  onclick="window.print()"><xsl:text>PRINT</xsl:text><span class="glyphicon glyphicon-print" aria-hidden="true"><xsl:text> </xsl:text></span></button>
                                    <button class="btn disabled" href="#" role="button" style="margin: 10px;">
                                        <img alt="Excel" height="25" id="rdf" src="{concat($gamsdev, '/img/TABELLENSYMBOL.png')}" title="HSSF"/>
                                    </button>
                                    
                                    <button type="button" class="btn" style="font-size:18px; background: none;"  onclick="clearData()"><xsl:text>CLEAR</xsl:text><span class="glyphicon glyphicon-remove"><xsl:text> </xsl:text></span></button>
                                </div>
                                <xsl:variable name="Table-ID" select="concat('table_id', position())"/>
                                <!-- call DataTable -->
                                <script>
                                    $(document).ready(function() {
                                    $('#databasket_table').DataTable();
                                    } );
                                </script>
                                <table id="databasket_table" class="table table-bordered" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th><xsl:text>ENTRY</xsl:text></th>
                                            <th><xsl:text>WHEN</xsl:text></th>
                                            <th><xsl:text>FROM</xsl:text></th>
                                            <th><xsl:text>TO</xsl:text></th>
                                            <th><xsl:text>MEASURABLE</xsl:text></th>
                                            <th><xsl:text></xsl:text></th>
                                        </tr>
                                    </thead>
                                    <tbody id="databasekt_tbody">
                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div id="databasekt_content">
                                    <xsl:text> </xsl:text>
                                </div>
                                <script>
                                    showData();
                                </script>
                            </div>    
                        </div>
                    </article>
                </section>
            </xsl:when>
            
            <!-- ///////////////////////// -->
            <!-- HOWTO -->
            <xsl:when test="$mode = 'howto'">
            	<xsl:variable name="HOWTO_TEI" select="document(concat('/context:depcha/', 'HOWTO'))"/>
            	
                <section class="row">
                   <!-- <script type="text/javascript">
                        $(document).ready(function(){
                        $('a.fancybox').fancybox({'type' : 'image'});
                        });
                    </script>-->
                	<article class="col-md-3">
                			<div class="card" style=" position :  position: -webkit-sticky;
	    	        position: sticky;
	    	        top: 50px;">
		                		<div class="card-body">
		                			<xsl:for-each select="$HOWTO_TEI//t:TEI/t:text/t:body/t:div">
			                            <div class="pb-2">
			                                <a href="{concat('#',@xml:id)}" onclick="scrolldown(this)">
			                                    <xsl:apply-templates select="t:head[@xml:id]"/>
			                                </a>
			                            	<!-- hier unterpunkte der Hauptpunkte -->
			                            	<!--<xsl:if test="t:div/t:head[@xml:id]">
			                            		<xsl:for-each select="t:div/t:head[@xml:id]"></xsl:for-each>
			                            	</xsl:if>-->
			                            </div>
			                        </xsl:for-each>
		                		</div>
                			</div>
                	</article>
                	<article class="col-md-9">
                		<div class="card">
	                        <div class="card-body">
	                            <xsl:apply-templates select="$HOWTO_TEI//t:TEI/t:text/t:body/t:div"/>
	                        </div>
	                     </div>
                	</article>
                 </section>
            </xsl:when>
            
            <!-- ///////////////////////// -->
            <!-- ABOUT -->
            <xsl:when test="$mode = 'about'">
                    <section class="col-md-12">
                        <article  class="card">
                            <div class="card-body">
                                <xsl:apply-templates select="document(concat('/context:depcha/', 'ABOUT'))/t:TEI/t:text/t:body/t:div"/>
                            </div>
                        </article>
                    </section>
            </xsl:when>
            
            <!-- ///////////////////////// -->
            <!-- HOME -->
            <xsl:when test="$mode = '' and $cid = 'context:depcha'">
                <section class="col-md-12">
                    <article class="card">
                        <div class="card-body">
                            <xsl:call-template name="home"/>
                        </div>
                    </article>
                </section>
            </xsl:when>
            
            <!-- ///////////////////////// -->
            <!-- COLLECTION -->
            <xsl:when test="$mode = 'collection'">
                <xsl:call-template name="collection"/>
            </xsl:when>
            <xsl:otherwise>
                <xsl:call-template name="home"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>
    
    <!-- /////////////////////////////////////// -->
    <!-- HOME -->
    <xsl:template name="home">
                  <h3 class="card-title">DEPCHA</h3>
                  <p>
                      <xsl:text>Since the semantic web offers opportunities to collect and compare data from multiple digital projects, the depcha project
                      looks to the potential of developing broad standards for producing semantically enriched digital editions of accounts. For its
                      initial stage, the depcha project will bring together economic historians, scholarly editors, and technical experts to discuss and test
                      emerging methods for semantic markup of account books.</xsl:text>
                  </p>
                  <p> 
                      <xsl:text>Contact:</xsl:text> 
                      <br/>
                      <a href="mailto:christopher.pollin@uni-graz.at">christopher.pollin@uni-graz.at</a>
                  </p>
    </xsl:template>
    
    <!-- /////////////////////////////////////// -->
    <!-- COLLECTION -->
    <xsl:template name="collection">
        <!-- every context is a dataset -->
        <!--  <xsl:variable name="Context" select="document('/archive/objects/context:depcha/methods/sdef:Object/getMetadata')"/>-->
        <xsl:variable name="Context" select="document('/context:depcha/METADATA')"/>
            <div class="col-12 col-md-12 card">
                <div class="card-header"> 
                    <h1 class="card-title">Data Sets</h1>
                    <div class="card-text">
                        <p>
                            <xsl:text>Here you can find an overview over all available data sets.</xsl:text><br/>
                        </p>
                    </div>
                </div>
                <div class="card-body">
                     <div class="row">
                         <xsl:for-each select="$Context//s:result">
                             <xsl:sort/>
                             <xsl:variable name="PARAM" select="encode-for-uri(concat('$1|&lt;https://gams.uni-graz.at/', s:identifier, '&gt;'))"/>
                             <div class="col-10 col-lg-10">
                                 <a href="{concat('/archive/objects/query:depcha.data-context/methods/sdef:Query/get?params=', $PARAM)}">
                                     <h2><xsl:value-of select="s:title"/></h2>
                                 </a>
                             </div>
                         </xsl:for-each>
                     </div>
                </div>
            </div>
    </xsl:template>
    
    <xsl:template match="t:div[@type='header']/t:head">
        <div class="card-header"> 
            <h1 class="card-title"><xsl:apply-templates/></h1>
            <!--<div class="card-text">
                <p>Here can be a nice Text!</p>
            </div>-->
        </div>
    </xsl:template>
    
    <xsl:template match="t:figure[@type='web']">
       <!-- <a class="fancybox" data-fancybox-group="group" href="{@source}" title="{@ana}">-->
            <img src="{@source}" class="rounded" alt="GAMS Workflow" style="display:block;margin-left:auto;margin-right:auto;margin-bottom:10px;margin-top:10px;max-width:50%"/>
        <!--</a>-->
    </xsl:template>
   
    <xsl:template match="t:div[not(@type='header')]/t:head">
        <h3 class="card-title">
            <xsl:choose>
				<xsl:when test="@xml:id">
					<h3 id="{@xml:id}">
						<xsl:apply-templates/>
					</h3>
				</xsl:when>
			<xsl:otherwise>
				<h3>
					<xsl:apply-templates/>
				</h3>
			</xsl:otherwise>
		</xsl:choose>
        </h3>
    </xsl:template>
    
    
    <xsl:template match="t:hi[@style='code']">
        <code>
            <xsl:apply-templates/>
        </code>
    </xsl:template>
	
	 <xsl:template match="t:hi[@style='italic']">
        <span class="font-italic">
            <xsl:apply-templates/>
        </span>
    </xsl:template>
	
	<xsl:template match="t:hi[@style='element']">
        <span class="text-info">
            <xsl:apply-templates/>
        </span>
    </xsl:template>
	
	<xsl:template match="t:hi[@style='attribute']">
        <span class="text-warning">
            <xsl:apply-templates/>
        </span>
    </xsl:template>

	<!-- creates example table in "how to bookkeep" -->
	<xsl:template match="t:table[@type='example']">
		<table class="table font-italic">
			<thead>
				 <tr>
        			<th>
        				<xsl:apply-templates select="t:head"/>
        			</th>
				 </tr>
			</thead>
		    <tbody>
		    	<xsl:for-each select="t:row">
		    		<tr>
		    			<xsl:for-each select="t:cell">
		    				 <td>
		    				 	<xsl:value-of select="."/>
		    				 </td>
		    			</xsl:for-each>
		      		</tr>
		    	</xsl:for-each>
		    </tbody>
		  </table>
	</xsl:template>
	
	<xsl:template match="t:p[@style='XML']">
		<pre>
			<code class="XML">
				<xsl:call-template name="styleXML"/>
			</code>
		</pre>
	</xsl:template>
    
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- element has  @ -->
    <!-- styles all elements with attributes for examples and usage -->
    <xsl:template name="styleXML">
        <span style="color:blue;">
            <xsl:text>&lt;</xsl:text>
            <xsl:value-of select="name()"/>
            <xsl:if test="@*">
                <xsl:text> </xsl:text>
            </xsl:if>
        </span>
        <xsl:for-each select="@*">
            <span style="color:orange;">
                <xsl:value-of select="name(.)"/>
                <xsl:text>=</xsl:text>
            </span>
            <span style="color:rgb(150, 0, 0);"><xsl:text>"</xsl:text>
                <xsl:value-of select="."/><xsl:text>"</xsl:text></span>
            <xsl:if test="not(position()=last())">
                <xsl:text> </xsl:text>
            </xsl:if>
        </xsl:for-each>
        <xsl:text>&gt;</xsl:text>
        <xsl:apply-templates/>
        <span style="color:blue;"><xsl:text>&lt;/</xsl:text><xsl:value-of select="name()"/><xsl:text>&gt;</xsl:text></span>
    </xsl:template>
	
	<xsl:template match="t:list">
		<ul>
			<xsl:apply-templates/>
		</ul>
	</xsl:template>
	
	<xsl:template match="t:item">
		<li>
			<xsl:apply-templates/>
		</li>
	</xsl:template>
    
    
    <xsl:template match="t:div[@type='body']">
        <div class="card-body">
            <xsl:apply-templates/>
        </div>
    </xsl:template>
    
    <xsl:template match="t:p">
        <p>
            <xsl:apply-templates/>
        </p>
    </xsl:template>
    
    <xsl:template match="t:lb">
        <br/>
    </xsl:template>
    
    <xsl:template match="t:ref">
        <a target="_blank">
            <xsl:attribute name="href">
                <xsl:value-of select="./@target"/>
            </xsl:attribute>
            <xsl:value-of select="."/>
        </a>
    </xsl:template>

</xsl:stylesheet>