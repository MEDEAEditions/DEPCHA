PREFIX bds: <http://www.bigdata.com/rdf/search#>
PREFIX bk: <https://gams.uni-graz.at/o:depcha.bookkeeping#>
PREFIX t: <http://www.tei-c.org/ns/1.0/>
PREFIX gams:<https://gams.uni-graz.at/o:gams-ontology/#>

#author:Georg Vogeler
#param: $1 = URI of data set = Collection, referenced by gams:isMemberOfCollection, e.g. <https://gams.uni-graz.at/context:depcha.wheaton>

# {"date": <xsl:value-of select="current-grouping-key()"/>,
#"from": <xsl:value-of select="$From_Sum"/>,
#"to": <xsl:value-of select="$To_Sum"/>,
#"cfnai": <xsl:value-of select="$test"/>}

# TODO: 
# Mit einem VALUES je eine ?From_Sum und eine ?To_Sum ermittelbar? 
# 	Oder irgendwie anders, z.B. nested select?
#
# Nicht nur die Dollars summieren: Andere WÃ¤hrungen? Cents?

SELECT (?year as ?date) ?fromto (SUM(?quantint) as ?totaldollarsperyear) (str(?party) as ?query)
WHERE {

	BIND($1 as ?party)
      ?ta bk:when ?when;
        bk:consistsOf ?tf .
   ?tf bk:transfers ?meas ;
       ?fromto ?party .
   ?meas a bk:Money .
   {?meas bk:quantity ?dollars ; bk:unit 'dollars' .}
   UNION
   {?meas bk:quantity ?cents ; bk:unit 'cents' .}
   BIND(xsd:integer(?dollars) as ?quantint)
   BIND(year(xsd:dateTime(concat(?when, 'T00:00:00'))) as ?year)
  }
GROUP BY ?year ?fromto ?party
ORDER BY ?year 
